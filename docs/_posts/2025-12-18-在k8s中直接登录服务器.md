# 2025-12-18-在k8s中借助nsenter直接登录到服务器上


## 背景
1. 集群的服务器有很多
2. 有时候需要直接登录到服务器上检查...



## 实现

```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: shell
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: shell
  namespace: shell
spec:
  selector:
    matchLabels:
      app: shell
  template:
    metadata:
      labels:
        app: shell
    spec:
      terminationGracePeriodSeconds: 0
      hostPID: true
      hostIPC: true
      hostNetwork: true
      containers:
        - name: main
          image: alpine:3.15
          imagePullPolicy: IfNotPresent
          securityContext:
            privileged: true
          command:
            - nsenter
          args:
            - "-t"
            - "1"
            - "-m"
            - "-u"
            - "-i"
            - "-n"
            - "sleep"
            - "99999999"

```
1. 先创建一个`namespace`
2. 在配置`alpine`,启动`nsenter`
3. 注意需要`privileged`权限,`hostPID` 等等...

## 使用:

找到podname:`k get po -n shell -o wide |grep <想登录的服务器hostname>`


进入shell: `k exec it -n shell <上面输出的pod-name> -- bash`
