(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{318:function(a,t,e){"use strict";e.r(t);var r=e(4),s=Object(r.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"在只运行http代理访问外网的情况下-安装vpn-wireguard-突破访问限制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#在只运行http代理访问外网的情况下-安装vpn-wireguard-突破访问限制"}},[a._v("#")]),a._v(" 在只运行HTTP代理访问外网的情况下,安装VPN(wireguard)突破访问限制")]),a._v(" "),t("h3",{attrs:{id:"背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[a._v("#")]),a._v(" 背景")]),a._v(" "),t("ul",[t("li",[a._v("有些特殊情况下, 服务器只允许通过HTTP代理访问网络, 禁止任何直连操作.")]),a._v(" "),t("li",[a._v("这样会为后续的运维造成巨大的麻烦, 为此需要一些方法能够绕开限制.")])]),a._v(" "),t("h3",{attrs:{id:"实现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[a._v("#")]),a._v(" 实现")]),a._v(" "),t("ul",[t("li",[a._v("基本原理是使用这个类库"),t("a",{attrs:{href:"https://github.com/erebe/wstunnel",target:"_blank",rel:"noopener noreferrer"}},[a._v("wstunnel"),t("OutboundLink")],1)]),a._v(" "),t("li",[a._v("这是一个能把tcp/udp包装成websocket数据包进行传递的程序")])]),a._v(" "),t("h4",{attrs:{id:"service"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[a._v("#")]),a._v(" service")]),a._v(" "),t("p",[a._v("启动"),t("code",[a._v("wstunnel")]),a._v("绑定1080端口,把流量转化到wireguard的端口(51820)上")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("wstunnel "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--server")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restrictTo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1:51820 ws://0.0.0.0:443\n")])])]),t("h4",{attrs:{id:"client"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#client"}},[a._v("#")]),a._v(" client")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("wstunnel "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n   "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--udp")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("51821")]),a._v(":127.0.0.1:51820 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n   "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("http_proxy"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n   ws://"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("服务端的IP"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(":443\n")])])]),t("p",[a._v("在修改wireguard总配置的endpoint为"),t("code",[a._v("127.0.0.1:51821")])]),a._v(" "),t("h3",{attrs:{id:"最后"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[a._v("#")]),a._v(" 最后")]),a._v(" "),t("ul",[t("li",[a._v("启动"),t("code",[a._v("wireguard")]),a._v("就能在服务器上通过vpn的IP远程到客户端了")]),a._v(" "),t("li",[a._v("注意http_proxy一般是不会保持长连接的,需要配置心跳否则会失联,在wireguard可以配置"),t("code",[a._v("PersistentKeepalive = 17")]),a._v("来保持连接")])])])}),[],!1,null,null,null);t.default=s.exports}}]);